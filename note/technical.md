# Technical details

## Correction of non-genetic correlations between z-scores

Suppose we have a phenotype vector generated by two components,
genotype matrix `G` and unwanted confounder matrix `U`:

```
y = G θ + U δ + G0 α
```

Let's take the advantages of this fact `G0 t(G) -> λΙ` where `λ` is
some constant.  Now consider two z-scores of the same number of SNPs:

```
z ~ t(G) y = t(G)G θ + t(G) U δ + t(G) G0 α
           -> R θ + t(G) U δ + λ0 I α
```
and

```
z0 ~ t(G0) y = t(G0)G θ + t(G) U δ + t(G0) G0 α
           -> λ I θ + t(G0) U δ + R0 α
```

Therefore correlation between `z` and `z0` will approach to `δ^2||u||` up
to some constant factor.


## Removing discrepancy between two reference panels in mediation analysis

Assume `X1 / sqrt(n1) = U1 D1 t(V1)` and `X / sqrt(n) = U D t(V)`.

```
E[α.hat]           = S1 R1 inv(S1) α
```
therefore
```
E[α]               = S1 inv(R1) inv(S1) α.hat
                   = S1 V1 inv(D1^2) t(V1) inv(S1) α.hat
```
Construct a "design matrix" for the mediation effect:
```
t(V) R inv(S) E[α] = t(V) V D^2 t(V) inv(S) α
                   = D^2 t(V) inv(S) S1 V1 inv(D1^2) t(V1) inv(S1) α.hat
M                  = D^2 t(V) inv(S) S1 (V1/D1) t(inv(D1)V1) * Zα
```
Mediation regression model assuming mean-field distribution of `β`:
```
E[Δ] = M E[β]
V[Δ] = M^2 V[β]
```
For a perfect mediation:
```
E[t(V)Zθ] = E[Δ]
```

